# Инструкция по загрузке игры в Yandex Games

## Проблема, которая была решена

Ранее при загрузке игры в Yandex Games возникала ошибка:
```
Uncaught TypeError: Failed to resolve module specifier "phaser".
Relative references must start with either "/", "./", or "../".
```

Это происходило потому, что загружался **исходный код** проекта, который использует ES6 модули с bare specifiers (`import Phaser from 'phaser'`). Браузер не может напрямую разрешить такие импорты без системы сборки.

## Решение

Необходимо загружать **собранную (production) версию** игры, а не исходный код.

## Пошаговая инструкция

### 1. Сборка проекта

Перед загрузкой в Yandex Games всегда собирайте проект:

```bash
npm install  # Установить зависимости (если еще не установлены)
npm run build  # Собрать production версию
```

После выполнения команды `npm run build` в папке `dist/` будет создана готовая для публикации версия игры.

### 2. Создание архива для Yandex Games

Необходимо создать ZIP-архив **только содержимого папки `dist/`**, а не самой папки.

**Правильно:**
```
kadastr-game.zip
├── index.html
├── assets/
│   └── index-*.js
├── back.jpg
├── cells/
├── houses/
└── maps/
```

**Неправильно:**
```
kadastr-game.zip
└── dist/
    ├── index.html
    └── ...
```

#### Создание архива в Linux/Mac:

```bash
cd dist
zip -r ../kadastr-game.zip .
cd ..
```

#### Создание архива в Windows:

1. Откройте папку `dist/`
2. Выделите **все содержимое** папки (Ctrl+A)
3. Правый клик → Отправить → Сжатая ZIP-папка
4. Или используйте 7-Zip/WinRAR для создания архива

### 3. Загрузка в Yandex Games

1. Перейдите в [консоль разработчика Yandex Games](https://console.yandex.ru/games/)
2. Выберите вашу игру или создайте новую
3. В разделе "Версии" нажмите "Загрузить новую версию"
4. Загрузите созданный ZIP-архив `kadastr-game.zip`
5. Дождитесь обработки и запустите тестовую версию

### 4. Проверка работоспособности

После загрузки откройте черновик игры в Yandex Games. Должно произойти следующее:

1. Появится экран загрузки с текстом "КАДАСТР"
2. Через несколько секунд экран загрузки исчезнет
3. Появится игровое поле с сеткой участков
4. Игра будет интерактивной и полностью функциональной

## Изменения в конфигурации

В файл `vite.config.js` были внесены следующие изменения для совместимости с Yandex Games:

```javascript
export default defineConfig({
  base: './', // Использование относительных путей вместо абсолютных
  build: {
    outDir: 'dist',
    assetsInlineLimit: 0, // Не встраивать ассеты в JS
    rollupOptions: {
      output: {
        manualChunks: undefined // Один bundle для упрощения
      }
    }
  }
})
```

### Ключевые настройки:

- **`base: './'`** - использует относительные пути (`./assets/...` вместо `/assets/...`), что критично для работы на Yandex Games
- **`assetsInlineLimit: 0`** - не встраивает изображения и другие ассеты в JS-файл
- **`manualChunks: undefined`** - создает один JS-файл вместо разделения на chunk'и

## Разработка vs Продакшн

### Для локальной разработки:

```bash
npm run dev  # Запускает dev-сервер на http://localhost:3000
```

### Для тестирования production сборки локально:

```bash
npm run build    # Сборка
npm run preview  # Запуск preview-сервера
```

### Для публикации на Yandex Games:

```bash
npm run build  # Сборка
cd dist && zip -r ../kadastr-game.zip . && cd ..  # Создание архива
# Затем загрузите kadastr-game.zip в консоль Yandex Games
```

## Частые проблемы

### Ошибка "Failed to resolve module specifier"

**Причина:** Загружен исходный код вместо собранной версии.

**Решение:** Убедитесь, что загружаете содержимое папки `dist/`, а не корневую папку проекта.

### Белый экран после загрузки

**Причина:** Неправильная структура архива или абсолютные пути.

**Решение:**
1. Проверьте, что архив содержит `index.html` в корне, а не в подпапке
2. Убедитесь, что в `vite.config.js` установлено `base: './'`
3. Пересоберите проект: `npm run build`

### Игра не загружается / ошибки в консоли

**Причина:** Возможно, архив был создан неправильно или файлы повреждены.

**Решение:**
1. Проверьте консоль браузера (F12) на наличие ошибок
2. Убедитесь, что все файлы из папки `dist/` попали в архив
3. Проверьте размер архива (должен быть около 1.5-2 MB)
4. Пересоздайте архив

## Автоматизация

Для удобства можно добавить в `package.json` скрипт для автоматического создания архива:

```json
{
  "scripts": {
    "build": "vite build",
    "build:yandex": "npm run build && cd dist && zip -r ../kadastr-game.zip . && cd ..",
    "dev": "vite",
    "preview": "vite preview"
  }
}
```

Тогда можно использовать одну команду:

```bash
npm run build:yandex
```

## Поддержка

Если после выполнения всех шагов игра все еще не работает:

1. Проверьте консоль браузера (F12) на наличие ошибок
2. Убедитесь, что локально игра работает: `npm run preview`
3. Проверьте размер и содержимое ZIP-архива
4. Обратитесь в поддержку Yandex Games с описанием проблемы и скриншотами ошибок
